"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[815],{485:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(5155),r=s(2115),l=s(6710),i=s(3742);function n(e){let{parentId:t,onUploadSuccess:s}=e,[n,c]=(0,r.useState)(!1),[o,d]=(0,r.useState)({}),x=(0,r.useCallback)(async e=>{for(let s of(c(!0),e)){let e=new FormData;e.append("file",s),t&&e.append("parentId",t);try{d(e=>({...e,[s.name]:0})),(await fetch("/api/files/upload",{method:"POST",body:e})).ok?(d(e=>({...e,[s.name]:100})),setTimeout(()=>{d(e=>{let t={...e};return delete t[s.name],t})},2e3)):console.error("Upload failed for",s.name)}catch(e){console.error("Upload error:",e)}}c(!1),null==s||s()},[t,s]),{getRootProps:m,getInputProps:h,isDragActive:u}=(0,l.VB)({onDrop:x,multiple:!0,maxSize:0x6400000});return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{...m(),className:"border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ".concat(u?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),children:[(0,a.jsx)("input",{...h()}),(0,a.jsx)(i.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),u?(0,a.jsx)("p",{className:"text-blue-600",children:"Drop the files here..."}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-600 mb-2",children:"Drag & drop files here, or click to select files"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Maximum file size: 100MB"})]})]}),Object.keys(o).length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:"Uploading Files"}),Object.entries(o).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,a.jsx)("span",{className:"truncate",children:t}),(0,a.jsxs)("span",{children:[s,"%"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(s,"%")}})})]},t)})]})]})}},5060:(e,t,s)=>{s.d(t,{A:()=>y});var a=s(5155),r=s(2108),l=s(6874),i=s.n(l),n=s(6766),c=s(5695),o=s(9994),d=s(5433),x=s(3782),m=s(4219),h=s(5500),u=s(5246),p=s(5141),f=s(3742),g=s(5895),b=s(5596);function y(){var e,t,s;let{data:l}=(0,r.useSession)(),y=(0,c.usePathname)(),j=(null==l||null==(e=l.user)?void 0:e.role)==="SUPER_ADMIN"||(null==l||null==(t=l.user)?void 0:t.role)==="ADMIN",w=[{name:"Dashboard",href:"/dashboard",icon:o.A},{name:"My Files",href:"/dashboard/files",icon:d.A},{name:"Shared with Me",href:"/dashboard/shared",icon:x.A}],N=[{name:"User Management",href:"/admin/users",icon:m.A},{name:"System Analytics",href:"/admin/analytics",icon:h.A},{name:"Settings",href:"/admin/settings",icon:u.A}],v=[{name:"Create Folder",icon:p.A,action:"create-folder"},{name:"Upload Files",icon:f.A,action:"upload-files"},{name:"Share Folder",icon:x.A,action:"share-folder"}],k=e=>y===e||y.startsWith(e+"/");return(0,a.jsxs)("div",{className:"flex flex-col w-64 bg-gray-900 text-white min-h-screen",children:[(0,a.jsx)("div",{className:"flex items-center h-16 px-6 bg-gray-800",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"w-8 h-8 bg-white rounded-lg flex items-center justify-center",children:[(0,a.jsx)(n.default,{src:"/logo.svg",alt:"Company Logo",width:24,height:24,className:"w-6 h-6",onError:e=>{e.currentTarget.style.display="none"}}),(0,a.jsx)(g.A,{className:"h-6 w-6 text-blue-600 hidden"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-white text-lg font-bold",children:"PMS Cloud"}),(0,a.jsx)("p",{className:"text-gray-300 text-xs",children:"File Management"})]})]})}),(null==l?void 0:l.user)&&(0,a.jsx)("div",{className:"px-6 py-4 bg-gray-800 border-b border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-medium text-sm",children:null==(s=l.user.name)?void 0:s.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-white text-sm font-medium truncate",children:l.user.name}),(0,a.jsx)("p",{className:"text-gray-300 text-xs truncate",children:l.user.email}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 mt-1",children:l.user.role})]})]})}),(0,a.jsxs)("div",{className:"px-6 py-4 border-b border-gray-700",children:[(0,a.jsx)("h3",{className:"text-gray-300 text-xs font-semibold uppercase tracking-wider mb-3",children:"Quick Actions"}),(0,a.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,a.jsxs)("button",{onClick:()=>(e=>{switch(e){case"create-folder":window.location.href="/dashboard/files?action=create-folder";break;case"upload-files":window.location.href="/dashboard/files?action=upload";break;case"share-folder":window.location.href="/dashboard/files?action=share"}})(e.action),className:"w-full flex items-center px-3 py-2 text-sm font-medium text-gray-300 rounded-lg hover:bg-gray-800 hover:text-white transition-colors group",children:[(0,a.jsx)(e.icon,{className:"mr-3 h-4 w-4 text-gray-400 group-hover:text-white"}),e.name]},e.action))})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,a.jsxs)("nav",{className:"flex-1 px-6 space-y-1",children:[w.map(e=>(0,a.jsxs)(i(),{href:e.href,className:"group flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(k(e.href)?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"),children:[(0,a.jsx)(e.icon,{className:"mr-3 h-5 w-5 ".concat(k(e.href)?"text-white":"text-gray-400 group-hover:text-white")}),e.name]},e.name)),j&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"border-t border-gray-700 mt-6 pt-6",children:[(0,a.jsx)("h3",{className:"px-3 text-xs font-semibold text-gray-300 uppercase tracking-wider mb-3",children:"Administration"}),(0,a.jsx)("div",{className:"space-y-1",children:N.map(e=>(0,a.jsxs)(i(),{href:e.href,className:"group flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(k(e.href)?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"),children:[(0,a.jsx)(e.icon,{className:"mr-3 h-5 w-5 ".concat(k(e.href)?"text-white":"text-gray-400 group-hover:text-white")}),e.name]},e.name))})]})})]}),(0,a.jsx)("div",{className:"flex-shrink-0 px-6 py-4 border-t border-gray-700",children:(0,a.jsxs)("button",{onClick:async()=>{try{await (0,r.signOut)({callbackUrl:"/auth/signin",redirect:!0})}catch(e){console.error("Logout error:",e),window.location.href="/auth/signin"}},className:"w-full group flex items-center px-3 py-2 text-sm font-medium text-gray-300 rounded-lg hover:bg-red-600 hover:text-white transition-colors",children:[(0,a.jsx)(b.A,{className:"mr-3 h-5 w-5 text-gray-400 group-hover:text-white"}),"Sign Out"]})})]})]})}},8932:(e,t,s)=>{s.d(t,{A:()=>u});var a=s(5155),r=s(2115),l=s(5433),i=s(1151),n=s(4684),c=s(184),o=s(5052),d=s(3782),x=s(4500),m=s(9337);function h(e){let{isOpen:t,onClose:s,fileId:l,fileName:i}=e,[n,c]=(0,r.useState)([]),[o,d]=(0,r.useState)(""),[h,u]=(0,r.useState)("VIEW"),[p,f]=(0,r.useState)(""),[g,b]=(0,r.useState)(!1),[y,j]=(0,r.useState)("");(0,r.useEffect)(()=>{t&&w()},[t]);let w=async()=>{try{let e=await fetch("/api/users");if(e.ok){let t=await e.json();c(t.users||[])}}catch(e){console.error("Error fetching users:",e)}},N=async()=>{if(!o)return void j("Please select a user to share with");b(!0),j("");try{let e=await fetch("/api/files/".concat(l,"/share"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sharedWith:o,permissions:h,expiresAt:p||null})});if(e.ok)j("File shared successfully!"),setTimeout(()=>{s(),j(""),d(""),u("VIEW"),f("")},1500);else{let t=await e.json();j(t.error||"Failed to share file")}}catch(e){console.error("Error sharing file:",e),j("Failed to share file")}finally{b(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsxs)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Share File"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(x.A,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Sharing: ",(0,a.jsx)("span",{className:"font-medium",children:i})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Share with user"}),(0,a.jsxs)("select",{value:o,onChange:e=>d(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Select a user..."}),n.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.email,")",e.isExternal&&" - External"]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permission level"}),(0,a.jsxs)("select",{value:h,onChange:e=>u(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"VIEW",children:"View only"}),(0,a.jsx)("option",{value:"DOWNLOAD",children:"View and download"}),(0,a.jsx)("option",{value:"EDIT",children:"Full access (view, download, edit)"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expires on (optional)"}),(0,a.jsx)("input",{type:"datetime-local",value:p,onChange:e=>f(e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",min:new Date().toISOString().slice(0,16)})]}),y&&(0,a.jsxs)("div",{className:"p-3 rounded-md text-sm ".concat(y.includes("successfully")?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:[y.includes("successfully")&&(0,a.jsx)(m.A,{className:"h-4 w-4 inline mr-1"}),y]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:N,disabled:g||!o,className:"flex-1 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Sharing...":"Share File"}),(0,a.jsx)("button",{onClick:s,className:"flex-1 bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"})]})]})]})}):null}function u(e){let{parentId:t,onFolderClick:s,refreshTrigger:x}=e,[m,u]=(0,r.useState)([]),[p,f]=(0,r.useState)(!0),[g,b]=(0,r.useState)(null),[y,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{f(!0);let e=await fetch(t?"/api/files?parentId=".concat(t):"/api/files");if(e.ok){let t=await e.json();u(t.files||[])}}catch(e){console.error("Error fetching files:",e)}finally{f(!1)}})()},[t,x]);let w=async e=>{try{let s=await fetch("/api/files/".concat(e,"/delete"),{method:"POST"});if(s.ok){let e=await fetch(t?"/api/files?parentId=".concat(t):"/api/files");if(e.ok){let t=await e.json();u(t.files||[])}b(null)}else{let e=await s.json();alert("Error: ".concat(e.error))}}catch(e){console.error("Error deleting file:",e),alert("Failed to delete file")}};return p?(0,a.jsxs)("div",{className:"p-6 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading files..."})]}):0===m.length?(0,a.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,a.jsx)(l.A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),(0,a.jsx)("p",{children:"No files or folders yet"}),(0,a.jsx)("p",{className:"text-sm",children:"Upload some files to get started"})]}):(0,a.jsxs)(a.Fragment,{children:[y&&(0,a.jsx)(h,{isOpen:!0,onClose:()=>{j(null)},fileId:y.fileId,fileName:y.fileName}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3 text-center",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100",children:(0,a.jsx)(i.A,{className:"h-6 w-6 text-red-600"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mt-2",children:"Delete File"}),(0,a.jsx)("div",{className:"mt-2 px-7 py-3",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this file? This action cannot be undone."})}),(0,a.jsxs)("div",{className:"items-center px-4 py-3",children:[(0,a.jsx)("button",{onClick:()=>w(g),className:"px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-24 mr-2 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300",children:"Delete"}),(0,a.jsx)("button",{onClick:()=>{b(null)},className:"px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-24 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300",children:"Cancel"})]})]})})}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Files & Folders"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Modified"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Owner"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[e.isFolder?(0,a.jsx)(l.A,{className:"h-6 w-6 text-blue-500"}):(0,a.jsx)(n.A,{className:"h-6 w-6 text-gray-400"}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("button",{onClick:()=>e.isFolder&&(null==s?void 0:s(e.id)),className:"text-sm font-medium truncate block ".concat(e.isFolder?"text-blue-600 hover:text-blue-800 cursor-pointer hover:underline":"text-gray-900"),children:e.originalName}),(0,a.jsx)("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:e.mimeType})]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.isFolder?(0,a.jsx)("span",{className:"text-gray-400",children:"â€”"}):(e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]})(e.size)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-blue-600",children:e.owner.name.charAt(0).toUpperCase()})}),(0,a.jsx)("span",{className:"truncate",children:e.owner.name})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-1",children:[!e.isFolder&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{var t;return t=e.id,void window.open("/api/files/".concat(t,"/view"),"_blank")},className:"inline-flex items-center p-1.5 border border-transparent rounded-md text-gray-400 hover:text-blue-600 hover:bg-blue-50 transition-colors",title:"View file",children:(0,a.jsx)(c.A,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>((e,t)=>{let s=document.createElement("a");s.href="/api/files/".concat(e,"/download"),s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s)})(e.id,e.originalName),className:"inline-flex items-center p-1.5 border border-transparent rounded-md text-gray-400 hover:text-green-600 hover:bg-green-50 transition-colors",title:"Download file",children:(0,a.jsx)(o.A,{className:"h-4 w-4"})})]}),(0,a.jsx)("button",{onClick:()=>{j({fileId:e.id,fileName:e.originalName})},className:"inline-flex items-center p-1.5 border border-transparent rounded-md text-gray-400 hover:text-purple-600 hover:bg-purple-50 transition-colors",title:"Share",children:(0,a.jsx)(d.A,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>{b(e.id)},className:"inline-flex items-center p-1.5 border border-transparent rounded-md text-gray-400 hover:text-red-600 hover:bg-red-50 transition-colors",title:"Delete",children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})]})})]},e.id))})]})})]})]})}}}]);